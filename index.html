<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WFRP ‚Äì Gestionnaire de combat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lora&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="MJ.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <h1>‚öîÔ∏è WFRP ‚Äì Gestionnaire</h1>
      <div class="spacer"></div>
      <nav class="tabs" role="tablist" aria-label="Sections">
        <button class="tab is-active" data-tab="reserve" aria-selected="true">R√©serve</button>
        <button class="tab" data-tab="combat" aria-selected="false">Combat</button>
        <button class="tab" data-tab="rules" aria-selected="false">R√®gles</button>
      </nav>
      <button id="btn-version" class="ghost small" style="margin-left:10px; opacity:0.6;">v?</button>
    </div>
  </header>

  <main class="wrap">
    <section id="panel-reserve" class="panel is-active" role="region" aria-labelledby="tab-reserve">
      <h2>R√©serve (source de v√©rit√©)</h2>
      <div class="grid-2">
        <form id="form-add" class="card">
          <input type="hidden" name="id" value="">
          <h3 id="form-title">Nouveau profil</h3>
          <div class="grid-2">
            <label>Nom<input name="name" placeholder="Saskia la Noire" required></label>
            <label>Type<select name="kind"><option value="PJ">PJ</option><option value="Cr√©ature">Cr√©ature</option></select></label>
            <label>Initiative (I) <small class="muted">Score de caract√©ristique</small><input type="number" name="initiative" value="30"></label>
            <label>PV (Max)<input type="number" name="hp" value="12"></label>
          </div>
          <div class="armor-section" style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 6px;">
            <span class="muted" style="font-size: 0.9em; font-weight: bold;">Points d'Armure</span>
            <div class="grid-4" style="margin-top: 6px;">
              <label>T√™te<input type="number" name="armor_head" value="0"></label>
              <label>Corps<input type="number" name="armor_body" value="0"></label>
              <label>Bras<input type="number" name="armor_arms" value="0"></label>
              <label>Jambes<input type="number" name="armor_legs" value="0"></label>
            </div>
          </div>
          <details>
            <summary>Caracs (optionnel)</summary>
            <div class="grid-3">
              <label>CC<input type="number" name="CC"></label>
              <label>CT<input type="number" name="CT"></label>
              <label>F<input type="number" name="F"></label>
              <label>E<input type="number" name="E"></label>
              <label>I<input type="number" name="I"></label>
              <label>Ag<input type="number" name="Ag"></label>
              <label>Dex<input type="number" name="Dex"></label>
              <label>Int<input type="number" name="Int"></label>
              <label>FM<input type="number" name="FM"></label>
              <label>Soc<input type="number" name="Soc"></label>
            </div>
          </details>
          <div class="actions">
            <button type="submit" id="btn-submit-form">Ajouter</button>
            <button type="button" id="btn-cancel-edit" class="ghost" style="display:none;">Annuler</button>
            <div class="spacer"></div>
            <button type="button" id="seed-reserve" class="ghost small">Exemple</button>
            <button type="button" id="clear-reserve" class="danger ghost small">Vider</button>
          </div>
        </form>
        <div class="card">
          <div class="row">
            <h3>Liste</h3>
            <div class="spacer"></div>
            <input id="search-reserve" placeholder="Filtrer‚Ä¶" />
          </div>
          <div id="reserve-list" class="list"></div>
        </div>
      </div>
    </section>

    <section id="panel-combat" class="panel" role="region" aria-labelledby="tab-combat">
      
      <div class="controls row card">
        <div class="row">
            <button id="btn-save-file" style="border-color:#3e2e22;">üíæ Sauvegarder</button>
            <button id="btn-load-file" class="ghost">üìÇ Charger</button>
            <input type="file" id="file-input" accept=".json" style="display:none;" />
        </div>
        <div class="spacer"></div>
        <div class="row">
            <button id="btn-import" class="ghost">Imp. R√©serve</button>
            <button id="btn-export" class="ghost">Exp. R√©serve</button>
        </div>
        <div class="spacer"></div>
        <div class="row">
          <button id="btn-start">D√©marrer</button>
          <button id="btn-d100">Lancer d100</button>
          <button id="btn-reset" class="ghost" style="border-color:#b36e3a; color:#b36e3a;">Nettoyer Piste</button>
        </div>
      </div>

      <div class="row meta card">
        <span class="pill" id="pill-round">Round: 0</span>
        <span class="pill" id="pill-turn">Tour: ‚Äì</span>
        <div class="spacer"></div>
        <span class="muted">Glissez-d√©posez les cartes pour organiser l'ordre</span>
      </div>

      <div id="dice-prep-results" class="dice-result-stream card" style="min-height: 60px; margin-bottom: 16px;"></div>

      <div id="init-tracker" class="init-tracker card row"></div>

      <div class="zone-container active-container">
        <h3>üî• Zone Active (Au c≈ìur de l'action)</h3>
        <div id="zone-active" class="drop-zone" data-zone="active">
            <div class="placeholder">Glissez les combattants actifs ici...</div>
        </div>
      </div>

      <div class="zone-container bench-container">
        <h3>üí§ En attente / R√©serve tactique</h3>
        <div id="zone-bench" class="drop-zone" data-zone="bench"></div>
      </div>

      <details class="card" style="margin-top: 16px;">
        <summary class="row" style="cursor:pointer; font-weight:bold; color:#5a1d1d; padding:4px 0;">
          üìú Journal (Cliquer pour afficher/masquer)
        </summary>
        <div class="row" style="margin-top:10px; border-bottom:1px solid #ccc; padding-bottom:8px;">
            <div class="spacer"></div>
            <button id="btn-clear-log" class="ghost">Effacer l'historique</button>
        </div>
        <div id="log" class="log"></div>
      </details>

    </section>

    <section id="panel-rules" class="panel" role="region" aria-labelledby="tab-rules">
        <h2>Aides de Jeu & R√®gles</h2>
        
        <div class="card rule-block">
            <details>
                <summary>Localisation des d√©g√¢ts</summary>
                <div class="rule-content">
                    <p>D'apr√®s le <em>Livre de base de Warhammer Fantasy le Jeu de R√¥le (4e √©dition)</em> :</p>
                    
                    <h4>1. La R√®gle de base : Inverser les d√©s</h4>
                    <p>Pour d√©terminer o√π un coup atterrit apr√®s un Test de Corps √† corps ou de Projectiles r√©ussi, vous devez simplement <strong>inverser le r√©sultat des d√©s</strong> de votre jet d'attaque.</p>
                    <p class="example"><em>Exemple :</em> Si vous r√©ussissez avec un jet de <strong>23</strong>, la localisation est <strong>32</strong>. Si vous obtenez <strong>04</strong>, c'est <strong>40</strong>. Si vous obtenez <strong>10</strong>, c'est <strong>01</strong>.</p>

                    <h4>2. Le Tableau de Localisation</h4>
                    <ul>
                        <li><strong>01 ‚Äì 09 :</strong> T√™te</li>
                        <li><strong>10 ‚Äì 24 :</strong> Bras gauche (ou secondaire)</li>
                        <li><strong>25 ‚Äì 44 :</strong> Bras droit (ou principal)</li>
                        <li><strong>45 ‚Äì 79 :</strong> Corps</li>
                        <li><strong>80 ‚Äì 89 :</strong> Jambe gauche</li>
                        <li><strong>90 ‚Äì 00 :</strong> Jambe droite</li>
                    </ul>

                    <h4>3. Exception pour les Coups Critiques</h4>
                    <p>Si votre jet d'attaque est un <strong>Coup Critique</strong> (succ√®s sur un double, ex: 11, 22...), <strong>n'inversez pas</strong> le jet.</p>
                    <ul>
                        <li>Lancez un <strong>nouveau 1d100</strong> pour d√©terminer la localisation (voir tableau ci-dessus).</li>
                        <li>Lancez un <strong>second 1d100</strong> pour d√©terminer la gravit√© sur le Tableau des Critiques correspondant.</li>
                    </ul>

                    <h4>4. Cas particuliers</h4>
                    <ul>
                        <li><strong>Cr√©atures non-humano√Ødes :</strong> Bras ‚Üí Pattes avant, Jambes ‚Üí Pattes arri√®re.</li>
                        <li><strong>Viser :</strong> Possible de choisir une localisation, mais impose un <strong>malus de -20</strong> au test d'attaque.</li>
                    </ul>
                </div>
            </details>
        </div>
    </section>

  </main>

  <template id="tpl-actor">
    <div class="actor-card" draggable="true">
      <div class="actor-header row">
        <div class="actor-info">
            <strong class="name">Nom</strong>
            <div class="sub-info">
                <span class="badge clickable init-badge">Init 0</span>
                <span class="badge hp-badge">PV 0</span>
                <span class="badge adv-badge">AV 0</span>
            </div>
            <div class="states" style="margin-top:4px; display:flex; gap:4px; flex-wrap:wrap;"></div>
        </div>
        <div class="actor-actions">
            <button class="icon-btn btn-color" title="Couleur">üé®</button>
            <button class="icon-btn btn-state" title="Bless√©">ü©∏</button>
            <button class="icon-btn danger btn-remove" title="Retirer">‚úï</button>
        </div>
      </div>
      
      <div class="color-palette hidden">
          <div class="color-swatch" style="background:var(--card-bg-default);" data-c="default" title="D√©faut"></div>
          <div class="color-swatch" style="background:var(--card-bg-red);" data-c="red" title="Ennemi"></div>
          <div class="color-swatch" style="background:var(--card-bg-green);" data-c="green" title="Alli√©"></div>
          <div class="color-swatch" style="background:var(--card-bg-blue);" data-c="blue" title="Magie"></div>
          <div class="color-swatch" style="background:var(--card-bg-purple);" data-c="purple" title="Chaos"></div>
          <div class="color-swatch" style="background:var(--card-bg-orange);" data-c="orange" title="Boss"></div>
      </div>

      <div class="actor-controls row">
        <button class="tiny btn-hp-minus">‚àíPV</button>
        <button class="tiny btn-hp-plus">+PV</button>
        <div class="spacer"></div>
        <button class="tiny btn-adv-minus">‚àíAV</button>
        <button class="tiny btn-adv-plus">+AV</button>
      </div>

      <div class="actor-armor muted"></div>

      <div class="actor-dice-section">
        <div class="dice-list"></div>
        <button class="btn-add-dice full-width ghost small">+ Ajouter un jet</button>
      </div>
    </div>
  </template>

  <dialog id="dlg-import">
    <form method="dialog" class="card">
      <h3>Importer depuis la R√©serve</h3>
      <div id="import-list" class="list"></div>
      <div class="row actions">
        <div class="spacer"></div>
        <button value="cancel" class="ghost">Annuler</button>
        <button id="confirm-import">Importer</button>
      </div>
    </form>
  </dialog>

  <script src="MJ.js?v=2"></script>
</body>
</html>
